# プロジェクト基本方針（無料枠／Pages + Workers 構成）

- デプロイ構成（無料プラン）
  - 公開ページ（Pages）: 静的シェル（SSG）＋ブラウザ側で Workers API を fetch（CSR）。
  - 管理ページ（Pages）: 同様に静的構成＋ブラウザ側で Workers の管理 API を呼び出す（認証はクライアント実装）。
  - API（Workers）: Hono などで実装。Supabase Service Role は Secrets にのみ配置。

- 画像運用
  - アップロード: 管理ページでトリミング後、原本をそのまま R2 に保存（direct-to-R2）。
  - 表示: 決め打ちサイズ（200/400/800）のユニーク変換で配信。
  - 目標: すべて無料枠で運用（R2 10GB、Images 5,000 ユニーク変換）。

- ドメイン／環境
  - 先に公開ページをデプロイしてドメインを取得し、API とローカルを登録（`NEXT_PUBLIC_SITE_URL` 等）。
  - 管理ページの最終確認後に Pages へデプロイ。以降はローカルを開発環境として継続。

- Git／構成
  - monorepo は廃止し、このリポジトリに公開／管理／API をまとめて配置。
  - 影響範囲の変更は GitHub Copilot を活用し、横断的修正を実施。

- 紐づけ（詳細は以下を参照）
  - 公開ページ仕様: `公開ページ仕様.md`
  - SSG 方針: `SSG移行_CloudflarePages.md`
  - 画像配信／CDN: `画像配信とCDN.md`
  - 変換コスト: `画像変換コスト_2025-12-02.md`／`バリアント生成コスト試算_2025-12-03.md`
  - Public API: `Workers_Public_API指針.md`／`Workers_Products_API仕様.md`
  - RLS テンプレ: `Supabase_RLS_テンプレート.md`
  - サブドメイン設定: `公開サブドメイン設定.md`
