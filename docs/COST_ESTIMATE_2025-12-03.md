# コスト試算メモ（2025-12-03・実績前提アップデート）

12/02 版から前提・実測に変化はなく、構成は「公開 SSG シェル + CSR Fetch（Workers + Supabase + R2）」のままです。現行トラフィック規模ではすべて無料枠内に収まります。

## 変更点サマリ（12/02 → 12/03）
- 実装の見直しにより「画像のフォールバック（R2 公開 URL 優先）」で 404 リトライを削減。配信回数は同等または微減見込み。
- Workers API 仕様は変更なし（GET のみ、ETag + Edge Cache）。
- 管理の先行デプロイを想定（無料・商用可の Pages Free 推奨）。

## 現在の実績・前提（再掲）
- 月間 PV: 6,000〜8,000
- 1 PV あたり API リクエスト: 平均 5 → 30,000〜40,000 req/月
- R2 保存量: ~0.2GB、月間 GET: 80k〜100k
- Supabase DB: 0.3〜0.5GB 見込み（Free 500MB 枠を監視）

## 月額概算（USD）
- Workers: $0（Free 100k req/日以内、CPU ms はごく小）
- R2: $0（Storage 10GB、Op 充分な余裕）
- Pages: $0（500 builds/月 以内）
- Supabase: $0（DB ≤500MB / File ≤1GB / Egress ≤5GB）
- 合計: $0.00/月（現状実績の範囲）

## 配信方式別コスト見積（概算・月額）
下は主要選択肢ごとの概算レンジ（小規模トラフィック前提）。
- オプション A — `Pages + R2 + Supabase`（推奨）: $0〜$5/月
	- 理由: 現行の利用量では全て無料枠に収まる。将来的に R2 ストレージ増加や Supabase Pro が必要になった場合は別途発生。
- オプション B — `Cloudflare Images（Image Delivery）` を利用: $0〜$20/月
	- 理由: 変換リクエスト数に応じ料金発生（例: $0.50/1,000 変換など）。小規模なら月数ドル。
- オプション C — `専用 Node（sharp） + R2`（専用処理サーバ）: $5〜$40+/月
	- 理由: VPS/Cloud Run 等の実行環境コスト、運用コストがかかる。sharp を使った即時生成が必要な場合の選択肢。

## 推奨案（要点）
- 今すぐ動かす: **オプション A（Pages + R2 + Supabase）を採用**。理由はシンプル: 無料枠で始められ、Pages の Git デプロイ → 継続的デプロイが容易。画像は直接 R2 に PUT してメタを登録するワークフローがコスト・運用両面で最も効率的。
- 将来的に変換・配信負荷が上がる場合: Cloudflare Images に切り替えるか、オンデマンドで変換を行う Worker/サービスを追加する。変換数が多くなると Cloudflare Images の方が低オペレーションで安くなる可能性あり。

## 追加の留意点
- 画像のバリエーションと保存ポリシーを定めておく（例: original + thumb-400 + detail-800 のみ保存、不要な派生は都度削除）。
- 監視: Supabase の DB サイズ / R2 ストレージ増加を月次でチェックし、閾値が近づいたら Pro プランや別ストレージの検討を行う。

## 超過の可能性としきい値
- Supabase DB: 450MB 付近で注意、超過時は Pro $25/月
- R2 Storage: 8GB 以降で注意、10GB 超で従量
- Workers Requests: 日次 80k 以上のスパイクで注意

## 補足: 画像変換コスト
- 12/02 版の比較と同様。現状は「R2 原本 +（必要なら）Cloudflare Images Transform（Free 範囲）」が最小コスト。
- 将来ユニーク変換 >5,000/月 の場合は Images Paid（$0.50/1,000）や Workers+WASM（$5/月）を再評価。
