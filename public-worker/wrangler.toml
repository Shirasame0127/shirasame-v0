name = "public-worker"
main = "src/index.ts"
compatibility_date = "2025-12-02"
account_id = "cc4a35b866542fbddca136b1cfc53037"
workers_dev = true
# Enable Node.js compatibility for packages that import Node built-ins (node:...)
compatibility_flags = ["nodejs_compat"]
# The workers.dev host for this script will be served under your account's
# workers.dev namespace. For clarity we document the desired public host below.
# Public workers.dev domain (workers.dev): public-worker.shirasame-official.workers.dev
# Preview URL pattern (wildcard): *-public-worker.shirasame-official.workers.dev

# If you want to bind this Worker to specific hostnames (custom domains or
# preview patterns), you can add them to the `routes` array below. Note: routes
# must correspond to a zone you control for custom domains; workers_dev=true
# will publish to the account workers.dev namespace regardless.
# NOTE: Creating routes on an account subdomain is restricted in some CI
# environments and may cause deploy failures (error 10038). To avoid CI
# failures, we do NOT create custom routes here by default. Use the
# `workers.dev` hostname or configure routes manually in the Cloudflare
# dashboard if needed.
# routes = [
#     "https://public-worker.shirasame-official.workers.dev/*",
#     "https://*-public-worker.shirasame-official.workers.dev/*"
# ]

# If you want to bind to a custom route (example: api.example.com/*),
# uncomment and set the routes array below.
# routes = ["api.yoursite.com/*"]

[[r2_buckets]]
binding = "IMAGES"
bucket_name = "images"
preview_bucket_name = "images"

# NOTE: Secrets (SUPABASE_ANON_KEY, SUPABASE_URL, etc.) should be added
# using `wrangler secret put` or via the Cloudflare Dashboard. Do NOT
# put secret keys directly in this file.

[vars]
# 公開APIからの受け入れ許可オリジン（カンマ区切り）
PUBLIC_ALLOWED_ORIGINS = "https://admin.shirasame.com,https://www.shirasame.com,https://shirasame.com"
# 既存Next APIのベースURL（暫定プロキシ先）。例: https://admin.example.com
INTERNAL_API_BASE = ""

# Supabase anon 直取得（RLS前提）
SUPABASE_URL = "https://zikwelnhcpnnpurlomrf.supabase.co"
SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inppa3dlbG5oY3BubnB1cmxvbXJmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3MjU3MjksImV4cCI6MjA3OTMwMTcyOX0.jpXt88FpfYpfni8eHAh2zAXl22biBruWHA-MPnu4F1A"
# 公開サイトのオーナー（単一サイト運用前提）。RLSで不要なら空でも可
PUBLIC_OWNER_USER_ID = ""
# R2 公開URLとバケット名（basePath導出の補助）
R2_PUBLIC_URL = "https://images.shirasame.com"
# Prefer proxied images domain for runtime URL generation when available
IMAGES_DOMAIN = "https://images.shirasame.com"
R2_BUCKET = "images"

# Cloudflare D1/Queues等は現状未使用。Supabase直取得に切替する場合はANONキー等を[vars]へ。
# Public profile email used by GET /profile
PUBLIC_PROFILE_EMAIL = "shirasame.official@gmail.com"

[env.production]
name = "public-worker"
# Production-specific overrides can go here. We mirror top-level vars/bindings
# into the production env so `--env production` deploys with the correct config.
# Bind this worker to the production API custom domain so cookies can be set
# from https://api.shirasame.com. Actual route creation may require Cloudflare
# API token permissions when publishing.
routes = ["https://api.shirasame.com/*"]

[[env.production.r2_buckets]]
binding = "IMAGES"
bucket_name = "images"
preview_bucket_name = "images"

[env.production.vars]
PUBLIC_ALLOWED_ORIGINS = "https://admin.shirasame.com,https://www.shirasame.com,https://shirasame.com"
INTERNAL_API_BASE = ""
SUPABASE_URL = "https://zikwelnhcpnnpurlomrf.supabase.co"
SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inppa3dlbG5oY3BubnB1cmxvbXJmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3MjU3MjksImV4cCI6MjA3OTMwMTcyOX0.jpXt88FpfYpfni8eHAh2zAXl22biBruWHA-MPnu4F1A"
PUBLIC_OWNER_USER_ID = ""
R2_PUBLIC_URL = "https://images.shirasame.com"
R2_BUCKET = "images"
PUBLIC_PROFILE_EMAIL = "shirasame.official@gmail.com"
IMAGES_DOMAIN = "https://images.shirasame.com"
